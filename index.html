<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AI Localization Web App</title>

<style>
  * { box-sizing: border-box; }
  html, body { margin:0; padding:0; height:100%; }
  body {
    font-family: system-ui, Arial, sans-serif;
    background: linear-gradient(135deg,#7e5095 0%,#372483 50%,#201e40 100%);
    color:white;
  }
  .muted { color:rgba(255,255,255,.7); font-size:13px; }
  .btn {
    padding:10px 18px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.4);
    background:rgba(0,0,0,.35);
    color:white;
    cursor:pointer;
  }
  .btn-small { padding:6px 12px; font-size:12px; }
  .btn-primary { font-weight:700; text-transform:uppercase; }
  .row { display:flex; gap:12px; flex-wrap:wrap; margin:12px 0; }
  table { width:100%; border-collapse:collapse; background:rgba(0,0,0,.25); margin-top:16px; }
  th,td { border:1px solid rgba(255,255,255,.15); padding:10px; font-size:14px; }
  th { background:rgba(0,0,0,.35); }

  #loginScreen { min-height:100vh; display:flex; align-items:center; justify-content:center; }
  .login-card {
    width:360px; padding:24px;
    background:rgba(0,0,0,.45);
    border-radius:16px;
  }

  #appShell { display:none; padding:32px 40px; }
  #topBar { display:flex; align-items:center; gap:16px; margin-bottom:12px; }
  #authStatus { margin-left:auto; font-size:18px; font-weight:600; }

  .tabs { display:inline-flex; background:rgba(0,0,0,.25); border-radius:999px; padding:4px; }
  .tab-btn {
    border:none; background:none; color:white;
    padding:8px 18px; border-radius:999px; cursor:pointer;
  }
  .tab-active { background:rgba(255,255,255,.2); }
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginScreen">
  <div class="login-card">
    <h2>AI Localization Tool</h2>
    <input id="authEmail" placeholder="Email" style="width:100%;margin-bottom:8px;">
    <input id="authPassword" type="password" placeholder="Password" style="width:100%;margin-bottom:12px;">
    <div class="row">
      <button class="btn btn-primary" id="loginBtn">Sign in</button>
      <button class="btn" id="signupBtn">Sign up</button>
    </div>
  </div>
</div>

<!-- APP -->
<div id="appShell">
  <div id="topBar">
    <div style="font-size:20px;font-weight:600;">AI Localization</div>
    <div id="authStatus"></div>
    <button class="btn" id="logoutBtn">Log out</button>
  </div>

  <div class="tabs">
    <button class="tab-btn tab-active" id="tabTranslate">Translate</button>
    <button class="tab-btn" id="tabProjects">Projects</button>
    <button class="tab-btn" id="tabAdmin" style="display:none;">Admin</button>
  </div>

  <!-- TRANSLATE -->
  <div id="translateSection">✔ Your existing translate UI stays unchanged here</div>

  <!-- PROJECTS -->
  <div id="projectsSection" style="display:none;">
    <h2>My Projects</h2>
    <table id="projectsTable">
      <tr>
        <th>Name</th><th>Status</th><th>Languages</th><th>Date</th><th>Action</th>
      </tr>
    </table>
  </div>

  <!-- ADMIN -->
  <div id="adminSection" style="display:none;">
    <h2>Admin – All Projects</h2>
    <table id="adminProjectsTable">
      <tr>
        <th>Name</th>
        <th>User</th>
        <th>Status</th>
        <th>Date</th>
        <th>Action</th>
      </tr>
    </table>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = "https://dtctdmsdeurllyflwjwk.supabase.co";
const SUPABASE_ANON_KEY = "YOUR_ANON_KEY";
const supa = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const ADMIN_EMAILS = ["your.email@company.com"];

let currentUser=null, isAdmin=false;

const $=s=>document.querySelector(s);

async function refreshUser(){
  const {data}=await supa.auth.getUser();
  if(!data.user){
    $("#loginScreen").style.display="flex";
    $("#appShell").style.display="none";
    return;
  }
  currentUser=data.user;
  isAdmin=ADMIN_EMAILS.includes(currentUser.email);
  $("#authStatus").textContent="Hi, "+currentUser.email;
  $("#loginScreen").style.display="none";
  $("#appShell").style.display="block";
  if(isAdmin) $("#tabAdmin").style.display="inline-block";
}

$("#loginBtn").onclick=async()=>{
  await supa.auth.signInWithPassword({
    email:authEmail.value,
    password:authPassword.value
  });
  refreshUser();
};
$("#signupBtn").onclick=async()=>{
  await supa.auth.signUp({
    email:authEmail.value,
    password:authPassword.value
  });
  alert("Account created. Sign in.");
};
$("#logoutBtn").onclick=async()=>{
  await supa.auth.signOut();
  refreshUser();
};

$("#tabTranslate").onclick=()=>{
  tabTranslate.classList.add("tab-active");
  tabProjects.classList.remove("tab-active");
  tabAdmin.classList.remove("tab-active");
  translateSection.style.display="";
  projectsSection.style.display="none";
  adminSection.style.display="none";
};

$("#tabProjects").onclick=()=>{
  tabProjects.classList.add("tab-active");
  tabTranslate.classList.remove("tab-active");
  tabAdmin.classList.remove("tab-active");
  translateSection.style.display="none";
  projectsSection.style.display="";
  adminSection.style.display="none";
};

$("#tabAdmin").onclick=async()=>{
  tabAdmin.classList.add("tab-active");
  tabProjects.classList.remove("tab-active");
  tabTranslate.classList.remove("tab-active");
  translateSection.style.display="none";
  projectsSection.style.display="none";
  adminSection.style.display="";
  loadAdminProjects();
};

async function loadAdminProjects(){
  const r=await fetch("/api/getAllProjects");
  const j=await r.json();
  const t=$("#adminProjectsTable");
  t.innerHTML=`<tr><th>Name</th><th>User</th><th>Status</th><th>Date</th><th>Action</th></tr>`;
  j.projects.forEach(p=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${p.project_name}</td>
      <td>${p.owner_email}</td>
      <td>${p.status}</td>
      <td>${new Date(p.created_at).toLocaleString()}</td>
      <td>
        <button class="btn-small btn" onclick="approve('${p.id}')">Approve</button>
        <button class="btn-small btn" onclick="deleteProj('${p.id}')">Delete</button>
      </td>`;
    t.appendChild(tr);
  });
}

async function approve(id){
  await fetch("/api/setProjectStatus",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({projectId:id,status:"Approved"})
  });
  loadAdminProjects();
}
async function deleteProj(id){
  await fetch("/api/deleteProject",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id})});
  loadAdminProjects();
}

refreshUser();
</script>
</body>
</html>
